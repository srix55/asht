<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Data Structures
  #

Data structures specifically used for caching at the client and server side.


  Client side
  #

The client side database is object oriented - isar. Separate tables to mark cache states are held and data is never duplicated or the regular tables are never marked dirty.


Let&rsquo;s take an example. Consider the player object held in isar. Note that client-id and user-ids are to allow for multiple logins from the same app (common in desktop usecases)"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/docs/caching/data-structures/"><meta property="og:site_name" content="Signage Docs"><meta property="og:title" content="Data Structures"><meta property="og:description" content="Data Structures # Data structures specifically used for caching at the client and server side.
Client side # The client side database is object oriented - isar. Separate tables to mark cache states are held and data is never duplicated or the regular tables are never marked dirty.
Let’s take an example. Consider the player object held in isar. Note that client-id and user-ids are to allow for multiple logins from the same app (common in desktop usecases)"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><title>Data Structures | Signage Docs</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=http://localhost:1313/docs/caching/data-structures/><link rel=stylesheet href=/book.min.a7616cf2799b58bddffce9438e31fdbfc6393687cfc0950a4a17cd1cce7e35f6.css integrity="sha256-p2Fs8nmbWL3f/OlDjjH9v8Y5NofPwJUKShfNHM5+NfY=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.8055c20c11bab2948f35a214cd3b34d0049bc9809df8d235cf0b2e0a5e3b3140.js integrity="sha256-gFXCDBG6spSPNaIUzTs00ASbyYCd+NI1zwsuCl47MUA=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=http://localhost:1313/docs/caching/data-structures/index.xml title="Signage Docs"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Signage Docs</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-5fdf93cd314ec47df39ee998b89605b2 class=toggle checked>
<label for=section-5fdf93cd314ec47df39ee998b89605b2 class="flex justify-between"><a href=/docs/caching/>Caching</a></label><ul><li><a href=/docs/caching/strategy/>Strategy</a><ul></ul></li><li><a href=/docs/caching/data-structures/ class=active>Data Structures</a><ul></ul></li><li><a href=/docs/caching/scenarios/>Scenarios</a><ul></ul></li></ul></li><li><input type=checkbox id=section-4e5caaf6365b6353a122fd9e35c00b08 class=toggle>
<label for=section-4e5caaf6365b6353a122fd9e35c00b08 class="flex justify-between"><a href=/docs/dev/>Dev</a></label><ul><li><input type=checkbox id=section-93509623b841973ade448228f6a7245a class=toggle>
<label for=section-93509623b841973ade448228f6a7245a class="flex justify-between"><a href=/docs/dev/checklists/>Checklists</a></label><ul><li><input type=checkbox id=section-cd85b26f7f821c87127cc7c5ab2be114 class=toggle>
<label for=section-cd85b26f7f821c87127cc7c5ab2be114 class="flex justify-between"><a href=/docs/dev/checklists/flutter_ui/>Flutter UI</a></label><ul></ul></li></ul></li><li><input type=checkbox id=section-342701e3704fa08e1bf5178f22301bff class=toggle>
<label for=section-342701e3704fa08e1bf5178f22301bff class="flex justify-between"><a href=/docs/dev/gcp/>GCP Deploy</a></label><ul></ul></li><li><input type=checkbox id=section-62f6752f338b4e8972e68d919e388f1b class=toggle>
<label for=section-62f6752f338b4e8972e68d919e388f1b class="flex justify-between"><a href=/docs/dev/setup/>Local Setup</a></label><ul></ul></li><li><input type=checkbox id=section-8a7fd608f954780ffa4e272058ad1f8f class=toggle>
<label for=section-8a7fd608f954780ffa4e272058ad1f8f class="flex justify-between"><a href=/docs/dev/setup_fedora/>Local Setup (Fedora)</a></label><ul></ul></li><li><input type=checkbox id=section-a4a95fe5b98a6ee596e16de8c518475a class=toggle>
<label for=section-a4a95fe5b98a6ee596e16de8c518475a class="flex justify-between"><a href=/docs/dev/mac/>Mac</a></label><ul></ul></li></ul></li><li><input type=checkbox id=section-20d497b48986a632cbad2fbd9940c776 class=toggle>
<label for=section-20d497b48986a632cbad2fbd9940c776 class="flex justify-between"><a href=/docs/manual/>Dev Manual</a></label><ul></ul></li><li><input type=checkbox id=section-2f9d02b5146d32013b75800d20839f0c class=toggle>
<label for=section-2f9d02b5146d32013b75800d20839f0c class="flex justify-between"><a href=/docs/player_registration/>Player Registration</a></label><ul></ul></li><li><input type=checkbox id=section-401ec0f4fea4e1b33d16a959f93c7b54 class=toggle>
<label for=section-401ec0f4fea4e1b33d16a959f93c7b54 class="flex justify-between"><a href=/docs/cheats/>Cheats</a></label><ul><li><a href=/docs/cheats/http/>Http</a><ul></ul></li></ul></li><li><input type=checkbox id=section-b439b1f12afb2bdb787d45ce1eefc920 class=toggle>
<label for=section-b439b1f12afb2bdb787d45ce1eefc920 class="flex justify-between"><a href=/docs/snippets/>Snippets</a></label><ul><li><a href=/docs/snippets/jpa/>JPA</a><ul></ul></li><li><a href=/docs/snippets/rest/>Rest</a><ul></ul></li><li><a href=/docs/snippets/dart/>Dart</a><ul></ul></li></ul></li></ul><ul><li><a href=/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Data Structures</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#data-structures>Data Structures</a><ul><li><a href=#client-side>Client side</a><ul><li></li></ul></li><li><a href=#server-side>Server side</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=data-structures>Data Structures
<a class=anchor href=#data-structures>#</a></h1><p>Data structures specifically used for caching at the client and server side.</p><hr><h2 id=client-side>Client side
<a class=anchor href=#client-side>#</a></h2><p>The client side database is object oriented - <a href=https://isar.dev/>isar</a>. Separate tables to mark cache states are held and data is never duplicated or the regular tables are never marked dirty.</p><ul><li><p>Let&rsquo;s take an example. Consider the <code>player</code> object held in isar. Note that <code>client-id</code> and <code>user-id</code>s are to allow for multiple logins from the same app (common in desktop usecases)</p><table><thead><tr><th>client-id</th><th>user-id</th><th>id</th><th>name</th><th>notes</th><th>status</th></tr></thead><tbody><tr><td>c123</td><td>u997</td><td>n337</td><td>Lobby TV</td><td>Displays appointments</td><td>active</td></tr><tr><td>c123</td><td>u997</td><td>a127</td><td>Ads Front</td><td>Shows weekly offers</td><td>active</td></tr></tbody></table><p>A separate table <code>player-cache</code> and <code>list-cache</code> is maintained.</p><h5 id=player-cache>Player-cache
<a class=anchor href=#player-cache>#</a></h5><table><thead><tr><th>client-id</th><th>user-id</th><th>id</th><th>name</th><th>notes</th><th>status</th></tr></thead><tbody><tr><td>c123</td><td>u997</td><td>n337</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>c123</td><td>u997</td><td>a127</td><td>✓</td><td>✓</td><td>✓</td></tr></tbody></table><h5 id=list-cache>list-cache
<a class=anchor href=#list-cache>#</a></h5><table><thead><tr><th>client-id</th><th>user-id</th><th>type</th><th>list</th></tr></thead><tbody><tr><td>c123</td><td>u997</td><td>Player</td><td>✓</td></tr></tbody></table><p><em>Why do we need a list-cache?</em> Suppose a new player is created at the server, where would you mark it as dirty at the client side. So, the next time the user opens the player-list view, he checks to see the list-cache table to validate.</p></li><li><p>An SSE arrives</p><pre tabindex=0><code>server-version: 2021-08-25T13:12:02.240Z-0000
change-type: player-status
player-id: a127
request-id: 2021-08-25T13:12:02.240Z-0000-clienta-user337-dev033
</code></pre></li><li><p>player a127&rsquo;s status is marked dirty</p><table><thead><tr><th>client-id</th><th>user-id</th><th>id</th><th>name</th><th>notes</th><th>status</th></tr></thead><tbody><tr><td>c123</td><td>u997</td><td>n337</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>c123</td><td>u997</td><td>a127</td><td>✓</td><td>✓</td><td>✗</td></tr></tbody></table></li><li><p>server-version at the client is updated to <code>2021-08-25T13:12:02.240Z-0000</code></p></li><li><p>If the status is currently displayed, it should be notified and immediately fetched. Otherwise, nothing else is done.</p></li><li><p>User opens the player page that shows a127&rsquo;s status. It sees that the cache is dirty. So, fetches the status, stores the data in the regular isar object and marks the attribute in <code>player-cache</code> as clean again.</p><table><thead><tr><th>id</th><th>name</th><th>notes</th><th>status</th></tr></thead><tbody><tr><td>n337</td><td>✓</td><td>✓</td><td>✓</td></tr><tr><td>a127</td><td>✓</td><td>✓</td><td>✓</td></tr></tbody></table></li></ul><hr><h2 id=server-side>Server side
<a class=anchor href=#server-side>#</a></h2><p>Redis holds every client&rsquo;s current version. Version is just an hlc. Postgres holds details of that version.</p><ul><li>What redis looks like<table><thead><tr><th>tenant-id</th><th>current-version</th></tr></thead><tbody><tr><td>tnt33727</td><td>2022-08-25T12:12:02.240Z-0000</td></tr><tr><td>tnt99878</td><td>2022-08-25T10:19:02.240Z-0024</td></tr></tbody></table></li><li>Details at postgres<table><thead><tr><th>tenant-id</th><th>version</th><th>request-id</th><th>change-type</th><th>change-details</th></tr></thead><tbody><tr><td>tnt33727</td><td>2022-08-25T12:12:02.240Z-0000</td><td>2022-08-25T12:12:02.240Z-0000-clientid-userid-devid</td><td>player-status</td><td>player-id: a127</td></tr></tbody></table></li><li>Some rules<ul><li>Server checks for duplicate request ids and doesn&rsquo;t serve them</li><li>Server doesn&rsquo;t entertain requests that are ahead by more than a minute or behind by more than 3 mins</li><li>Largest hlc wins in a conflict</li></ul></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#data-structures>Data Structures</a><ul><li><a href=#client-side>Client side</a><ul><li></li></ul></li><li><a href=#server-side>Server side</a></li></ul></li></ul></nav></div></aside></main></body></html>